{% extends "base.html" %}

{% block title %}Search Trains - Train Booking System{% endblock %}

{% block content %}
<div class="card">
    <h2 style="text-align: center; margin-bottom: 2rem;">Search Trains</h2>
    
    <form id="search-form" style="max-width: 800px; margin: 0 auto;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label for="source">Source Station</label>
                <input type="text" id="source" name="source" placeholder="e.g., New Delhi" required>
            </div>
            
            <div class="form-group">
                <label for="destination">Destination Station</label>
                <input type="text" id="destination" name="destination" placeholder="e.g., Mumbai" required>
            </div>
        </div>
        
        <button type="submit" class="btn btn-primary" style="width: 100%;">Search Trains</button>
    </form>
</div>

<div id="results-container"></div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('search-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const source = document.getElementById('source').value;
    const destination = document.getElementById('destination').value;
    const resultsContainer = document.getElementById('results-container');
    
    resultsContainer.innerHTML = '<div class="card"><p style="text-align: center;">Searching...</p></div>';
    
    try {
        const response = await fetch(`${API_BASE_URL}/schedules/search?source=${encodeURIComponent(source)}&destination=${encodeURIComponent(destination)}`);
        const data = await response.json();
        
        if (response.ok && data.schedules.length > 0) {
            let html = '<div class="card"><h3>Search Results</h3><table>';
            html += '<thead><tr><th>Train</th><th>From</th><th>To</th><th>Departure</th><th>Arrival</th><th>Fare</th><th>Action</th></tr></thead><tbody>';
            
            data.schedules.forEach(schedule => {
                html += `
                    <tr>
                        <td>${schedule.train_name} (${schedule.train_number})</td>
                        <td>${schedule.source_station}</td>
                        <td>${schedule.destination_station}</td>
                        <td>${schedule.departure_time}</td>
                        <td>${schedule.arrival_time}</td>
                        <td>â‚¹${schedule.base_fare}</td>
                        <td><a href="/book/${schedule.id}" class="btn btn-success">Book Now</a></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            resultsContainer.innerHTML = html;
        } else {
            resultsContainer.innerHTML = '<div class="card"><div class="alert alert-info">No trains found for this route.</div></div>';
        }
    } catch (error) {
        resultsContainer.innerHTML = '<div class="card"><div class="alert alert-error">Error searching trains</div></div>';
    }
});
</script>
{% endblock %}
